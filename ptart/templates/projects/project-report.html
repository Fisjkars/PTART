<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Report for {{ project.name }} </title>

    <link href="/static/img/favicon.ico" rel="shortcut icon" type="image/png" />

    <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/static/css/plugins/highlight/agate.css" rel="stylesheet" type="text/css">
    <link href="/static/css/plugins/html-sheets-of-paper/a4.css" rel="stylesheet" type="text/css">
    <link href="/static/css/plugins/morris/morris.css" rel="stylesheet" type="text/css">
    <link href="/static/css/customs/badges.css" rel="stylesheet" type="text/css">
    <link href="/static/css/customs/print.css" rel="stylesheet" type="text/css">

    <style>
        .logo {
            text-align: center;
            padding-top: 8cm;
        }

        .mainTitle {
            padding-top: 5cm;
            text-align: center;
        }

        code {
            white-space: pre-wrap; /* In order to manage the overflow in report */
        }
    </style>
</head>

<body class="document">

    <!-- Logo page -->
    <div class="page logo">
        <img src="/static/img/logo.png" alt="" />
    </div>

    <!-- Header page -->
    <div class="page">
        <div class="mainTitle mb-5">
            <h1 class="mb-2">{{ project.name }}</h1>
            <p class="lead mb-2">Date: {{ project.added }}</p>
            <i> This report has been automatically generated by PTART project
                (<a href="https://github.com/Fisjkars/PTART">https://github.com/Fisjkars/PTART</a>)
            </i>
        </div>

        <div class="mb-5">
            <b>Pentested by:</b>
            <ul>
                {% for pentester in project.pentesters.all %}
                <li>{{ pentester.username }} - {{ pentester.first_name }} {{ pentester.last_name }}</li>
                {% endfor %}
            </ul>
        </div>

        <div>
            <div id="projectScope">{{ project.scope }}</div>
        </div>
    </div>
    <!-- End of Header page -->

    <!-- Statistics page -->
    <!-- End of Statistics page -->

    <!-- Table of chapter page -->
    <div class="page">
        <h3 class="mb-5">Table of chapter</h3>
        {% for assessment in project.assessment_set.all %}
            {% if assessment.hit_set.all %}
                <h3><a href="#assessment_{{ assessment.id }}">{{ assessment.name }}</a></h3>
                {% for hit in assessment.hit_set.all %}
                    <a href="#hit_{{ hit.id }}">{{ hit.title }}</a><br/>
                {% endfor %}
                <div class="mb-3"></div>        
            {% endif %}
        {% endfor %}
    </div>
    <!-- End of Table of chapter page -->

    <!-- Hits page -->
    {% for assessment in project.assessment_set.all %}
        {% if assessment.hit_set.all %}
            <div id="assessment_{{ assessment.id }}" class="page">
                <h1 class="mb-5">{{ assessment.name }}</h1>

                {% for hit in assessment.hit_set.all %}
                    <div id="hit_{{ hit.id }}" class="mb-5">
                        <h3 class="mb-3">{{ hit.title }}</h3>
                        
                        <div class="container mb-3 p-2 border border-danger rounded">
                            <div class="row">
                                <div class="col col-lg-2 col-print-2">
                                    <b>Severity:</b>        
                                </div>
                                <div class="col col-lg-10 col-print-10">
                                    <span class="bc-badge bc-badge--p{{ hit.severity }}">P{{ hit.severity }}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col col-lg-2 col-print-2">
                                    <b>CVSSv3:</b>        
                                </div>
                                <div class="col col-lg-10 col-print-10">
                                    <span class="cvss label label-default">{{ hit.get_cvss_value }}</span>
                                    <i>({{ hit.get_cvss_string }})</i>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col col-lg-2 col-print-2">
                                    <b>Asset:</b>        
                                </div>
                                <div class="col col-lg-10 col-print-10">
                                    <a href="{{ hit.asset }}">{{ hit.asset }}</a>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col col-lg-2 col-print-2">
                                    <b>Labels:</b>        
                                </div>
                                <div class="col col-lg-10 col-print-10">
                                    {% for label in hit.labels.all %}
                                        <span class="badge badge-primary" style="background-color:{{ label.color }}">{{ label.title }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-1">&nbsp;</div>
                        <div id="mardownBody_{{ hit.id }}">{{ hit.body }}</div>
                        <div class="mb-2">&nbsp;</div>
                    
                        {% for screenshot in hit.screenshot_set.all %}
                            <img style="max-width: 17cm; margin-left: auto; margin-right: auto; display: block;" class="mb-3" src="/api/screenshot/png/{{screenshot.pk}}/" />
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endfor %}

    <!-- JS includes -->
    <script src="/static/js/jquery-3.4.0.min.js"></script>
    <script src="/static/js/plugins/highlight/highlight.min.js"></script>
    <script src="/static/js/plugins/marked/marked.min.js"></script>
    <script src="/static/js/plugins/morris/morris.min.js"></script>
    <script src="/static/js/plugins/raphael/raphael.min.js"></script>
    <script src="/static/js/customs/cvss.js"></script>
    
    <!-- Markdown display -->
    <script>
        //Project scope
        $("#projectScope").html(marked($("#projectScope").html()));

        //Hits bodies
        {% for assessment in project.assessment_set.all %}
            {% for hit in assessment.hit_set.all %}
                $("#mardownBody_{{ hit.id }}").html(marked($("#mardownBody_{{ hit.id }}").html()));
            {% endfor %}
        {% endfor %}
    </script>

    <!-- Unescape HTML from code tag and highlight the code -->
    <script>
        hljs.initHighlightingOnLoad();
        $('code').each(function () {
            $(this).html($('<div>').html($(this).html()).text());
        });
    </script>

    <!-- Morris chart -->
    <script>
    
    </script>
</body>

</html>