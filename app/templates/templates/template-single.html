{% extends "base.html" %}

{% block title %} Template | sh00t{% endblock %}

{% block page %}
    <div id="page-wrapper">
        <div class="container-fluid">

            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Template</h1>
                    <ol class="breadcrumb">
                        <li><i class="fa fa-dashboard"></i> <a href="/">Dashboard</a></li>
                        <li><i class="fa fa-file-text"></i> <a href="/app/templates/">Templates</a></li>
                        <li class="active">{{ template.name }}  <span id="response" class="small"></span></li>
                    </ol>
                </div>
            </div>

            {% include "_include/messages-container.html" %}

            <div class="row">
                <div class="col-lg-12">
                    <div class="form-group">
                        <label>Severity</label>
                        <select id="severity" class="form-control">
                                {% for sev in severities %}
                                    <option value={{sev}}> P{{sev}} </option>
                                {% endfor %}     
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Name</label>
                        <input id="name" class="form-control" value="{{ template.name }}" autocomplete="off" />
                    </div>
                    <div class="form-group">
                        <label>Body</label>
                        <textarea id="body" class="form-control" rows="10">{{ template.body }}</textarea>
                    </div>
                    <input id="id" type="hidden" value="{{ template.id }}"/>
                    <button id="updateBtn" class="btn btn-primary">Update</button>
                    <button id="delBtn" class="btn btn-danger">Delete</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_foot %}
<script type="text/javascript">

    /**
     * Template updation success callback.
     */
    function templateUpdationSuccess(data) {
        success($("#messages"), "Template was Updated!");
    }

    /**
     * Template updation failure callback.
     */
    function templateUpdationFailure(data) {
        errorList($("#messages"), data.responseJSON);
    }

    /**
     * Update template.
     */
    $('#updateBtn').on('click', function () {
        cleanMessagesContainer($("#messages"));
        ajaxUpdateTemplate(templateUpdationSuccess, templateUpdationFailure, $("#id").val(), $("#severity").val(), $("#name").val(), $("#body").val());
    });

    /**
     * Template deletion success callback.
     */
    function templateDeletionSuccess(data) {
        success($("#messages"), "Template was deleted! You will redirect in 2s!");
        setTimeout(function () {
            history.go(-1);
        }, 2000);
    }

    /**
     * Template deletion failure callback.
     */
    function templateDeletionFailure(data) {
        error($("#messages"), "Template was not found");
    }

    /**
     * Delete template.
     */
    $('#delBtn').on('click', function () {
        bootbox.confirm({
            message: "Are you sure to delete the template?",
            buttons: {
                confirm: {
                    label: 'Yes',
                    className: 'btn-success'
                },
                cancel: {
                    label: 'No',
                    className: 'btn-danger'
                }
            },
            callback: function (result) {
                if (result) {
                    cleanMessagesContainer($("#messages"));
                    ajaxDeleteTemplate(templateDeletionSuccess, templateDeletionFailure, $("#id").val());
                }
            }
        });
    });
</script>
{% endblock %}